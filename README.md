# GraPPI: A Retrieve-Divide-Solve GraphRAG Framework for Large-scale Protein-protein Interaction Exploration


An API system for analyzing protein interaction networks and generating customized recommendations based on user queries and network properties.

## Project Structure
```
protein_analysis/
├─── config.py           # Configuration settings and environment variables
├─── models.py           # Neo4j database connection and models
├─── analysis.py         # Core analysis functionality
├─── graph_utils.py      # Graph manipulation utilities
├─── recommendation.py   # LLM-based recommendation system
├─── llm_utils.py        # LLM helper functions
├─── prompts.py          # LLM prompt templates
├─── main.py            # FastAPI server
├─── requirements.txt    # Python dependencies
└──  test_api.py        # API testing script
```

## Prerequisites

1. Python 3.8 or higher
2. Neo4j database access credentials
3. OpenAI API key
4. Google Colab account (recommended for testing)
5. ngrok account and authtoken

## Installation

1. Create a virtual environment:
```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

2. Install dependencies:
```bash
pip install -r requirements.txt
```

3. Replace `OPENAI_API_KEY` in the `.env.example` file with your own OpenAI API key:
```.env.example
OPENAI_API_KEY="your_openai_key"
```

## API Parameters

### POST /analyze
Analyzes protein networks based on user query.

Request Parameters:
- `start_protein` (str): Starting protein name for network analysis
- `num_graphs` (int): Number of graphs to generate with different n_fold values
- `query` (str): User query describing the relationship or property to analyze

Request Example:
```json
{
    "start_protein": "MARK4",
    "num_graphs": 4,
    "query": "Find protein paths that the end protein phosphorylates MARK4"
}
```

Response:
```json
{
    "message": "Analysis complete",
    "num_graphs_processed": 4,
    "results": [
        {
            "fold": 1,
            "filename": "results_MARK4_d2_k30_f1.json",
            "graph_name": "MARK4_d2_k30_f1"
        }
        // ... additional results
    ]
}
```

### GET /health
Health check endpoint to verify server status.

Response:
```json
{
    "status": "healthy"
}
```

## Testing locally
1. Start the server first by running main.py
```python
!python main.py
```
After activating the server, you will have the local server URL.
2. Run test_backend.py with the actual local server

```python
!python test_backend.py #Remember to input your actual local server url
```

## Testing in Google Colab

Due to hnswlib installation constraints, testing through Google Colab is recommended:

1. Create a new Colab notebook and add setup code:

```python
# Install required packages
!pip install fastapi uvicorn pyngrok neo4j langchain-openai networkx numpy hnswlib python-dotenv nest_asyncio pyngrok

# Import and setup
from pyngrok import ngrok
import nest_asyncio
import os

# Apply nest_asyncio
nest_asyncio.apply()

# Set environment variables

os.environ['OPENAI_API_KEY'] = "your_openai_key"

# Setup ngrok
ngrok.set_auth_token("your_ngrok_token")
public_url = ngrok.connect(8000).public_url
print(f'Public URL: {public_url}')

# Start the server
!python main.py
```

2. Test using Python script locally:
replace NGROK_URL with the public_url generated by ngrok
```python
!python test_backend.py
```

## Configuration Parameters

### Config Settings (config.py)
- `DB_URI`: Neo4j database URI (provided by administrator)
- `DB_USER`: Neo4j database username (provided by administrator)
- `DB_PASSWORD`: Neo4j database password (provided by administrator)
- `DEFAULT_K`: Default number of neighbors for protein analysis (default: 30)
- `DEFAULT_DEPTH`: Default depth for network traversal (default: 2)
- `DIMENSION`: Dimension of protein embeddings (default: 1536)

### Analysis Parameters
- `k`: Number of nearest neighbors to consider (default: 30)
- `depth`: Depth of network traversal (default: 2)
- `n_fold`: Fold number for analysis (default: 1)
- `nodes_to_remove`: List of protein nodes to exclude from analysis
- `relationship_types_to_remove`: List of relationship types to exclude

## Troubleshooting

### Common Issues

1. Connection Errors:
   - Verify ngrok tunnel is active and URL is correct
   - Check if Colab server is running
   - Ensure ports are not blocked

2. Neo4j Connection Issues:
   - Verify database credentials in environment variables
   - Check if database is accessible from Colab
   - Ensure required indices exist

3. Dependencies:
   - Use Colab for hnswlib compatibility
   - Install dependencies in correct order
   - Check Python version compatibility

4. Runtime Issues:
   - Verify OpenAI API key validity
   - Monitor rate limits
   - Check input data format
   - Ensure sufficient memory for graph operations

## License

This project is licensed under the MIT License - see the LICENSE file for details.